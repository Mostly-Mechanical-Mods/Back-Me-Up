on_war_invalidated = {
	trigger = {
		NOT = { war = { using_cb = claim_cb }}
	}
}
# A title is lost by a character
# root = the old holder
# scope:title = the title that changes hands
# scope:new_holder = new holder.
on_title_lost = {
	on_actions = {
		# BMU_on_title_lost
	}
}

BMU_on_title_lost = {
	trigger = {
		scope:title = { has_variable = pressed_claim }
	}
	effect = {
		save_scope_as = old_holder
		random_owned_story = {
			limit = {
				story_type = BMU_pressed_claim_story
				var:claimed_title = scope:title
			}
			save_scope_as = pressed_claim
		}
		BMU_transfer_claimed_press = {
			PRESSED_CLAIM = scope:pressed_claim
			CLAIMED_TITLE = scope:title
			OLD_CLAIM_TARGET = root
			NEW_CLAIM_TARGET = scope:new_holder
		}
	}
}

# called for wars after being transferred to a new defender
# root is the primary attacker
# scope:war is the war
# scope:defender is the new defender

on_war_transferred = {
	on_actions = {
		BMU_on_war_transferred
	}
}

BMU_on_war_transferred = {
	trigger = {
		# scope:war = { using_CB = BMU_pressed_claim_cb }
		# scope:defender = {
		# 	any_owned_story = {
		# 		story_type = BMU_pressed_claim_story
		# 		this = scope:war.var:pressed_claim
		# 	}
		# }
	}
	effect = {
		if = {
			limit = { debug_only = yes }
			debug_log = "BMU_on_war_transferred"
			debug_log_scopes = yes
		}
		if = {
			limit = {
				debug_log_details = yes
				scope:war = { using_cb = BMU_pressed_claim_cb }
				scope:defender = {
					any_owned_story = {
						story_type = BMU_pressed_claim_story
						this = scope:war.var:pressed_claim
					}
				}
			}
			scope:war.var:pressed_claim = {
				every_in_list = {
					variable = BMU_pressed_claim_stakeholders
					limit = {
						NOT = { is_participant_in_war = scope:war }
						var:status = flag:supporter
						var:contender = scope:defender
					}
					scope:war = { add_defender = prev.story_owner }
				}
			}
		}
		else = {
			debug_log = "no Pressed Claim found"
		}
	}
}


# A claim is gained by a character
# root = the claimant
# scope:title = the title that is claimed
# scope:transfer_type = flag:inheritance or none
on_explicit_claim_gain = {
	on_actions = {
		BMU_on_explicit_claim_gain
	}
}

BMU_on_explicit_claim_gain = {
	trigger = {
		scope:title = { has_variable = pressed_claim }
	}
	effect = {
		scope:title = {
			var:pressed_claim = {
				add_to_variable_list = {
					name = claimants
					target = root
				}
			}
		}
	}
}

# A claim is lost by a character
# root = the claimant
# scope:title = the title that was claimed
on_explicit_claim_lost = {
	on_actions = {
		BMU_on_explicit_claim_lost
	}
}

BMU_on_explicit_claim_lost = {
	trigger = {
		scope:title = { has_variable = pressed_claim }
	}
	effect = {
		scope:title = {
			var:pressed_claim = {
				remove_list_variable = {
					name = claimants
					target = root
				}
			}
		}
	}
}
