BMU_has_strong_claim = {
	scope = character
	saved_scopes = {
		title
	}
	is_shown = {
		has_strong_claim_on = scope:claimed_title
	}
}

BMU_has_weak_claim = {
	scope = character
	saved_scopes = {
		title
	}
	is_shown = {
		has_weak_claim_on = scope:claimed_title
	}
}

BMU_has_implicit_claim = {
	scope = character
	saved_scopes = {
		title
	}
	is_shown = {
		NOR = {
			has_claim_on = scope:claimed_title
			has_title = scope:claimed_title
		}
	}
}



BMU_set_pressed_claim_interaction = {
	scope = character
	saved_scopes = { claimed_title }
	effect = {
		random_in_list = {
			variable = pressed_claim_gui
			limit = { var:claimed_title = scope:claimed_title }
			save_scope_as = pressed_claim
		}
		set_variable = {
			name = pressed_claim_interaction
			value = scope:pressed_claim
		}
		clear_variable_list = stakeholders_gui
		if = {
			limit = { any_contender_story = { var:pressed_claim_story = scope:pressed_claim }}
			every_ally = { add_to_list = stakeholders }
			every_close_family_member = { add_to_list = stakeholders }
			every_vassal = { add_to_list = stakeholders }
			liege = { add_to_list = stakeholders }
			every_relation = {
				type = friend
				add_to_list = stakeholders
			}
			every_relation = {
				type = lover
				add_to_list = stakeholders
			}
			dynasty.dynast = { add_to_list = stakeholders }
			house.house_head = { add_to_list = stakeholders }
			every_relation = {
				type = stakeholder_proxy
				limit = {
					OR = {
						any_relation = {
							type = rival
							any_contender_story = { var:pressed_claim_story = scope:pressed_claim }
						}
						BMU_is_claim_target_vassal_that_follows_pressed_claim = { PRESSED_CLAIM = scope:pressed_claim }
					}
				}
				add_to_list = stakeholders
			}
		}
		every_in_list = {
			list = stakeholders
			# max = 1000
			# check_range_bounds = no
			limit = {
				is_landed = yes
				highest_held_title_tier >= tier_county
				NOT = { this = root }
			}
			# order_by = max_military_strength
			random_stakeholder_story = {
				limit = { var:pressed_claim_story = scope:pressed_claim }
				root = {
					add_to_variable_list = {
						name = stakeholders_gui
						target = prev
					}
				}
			}
		}
		# set_variable = {
		# 	name = stakeholder_count
		# 	value = {
		# 	scope:pressed_claim = {
		# 		every_in_list = {
		# 			variable = stakeholders
		# 			limit = {
		# 				root = {
		# 					is_character_interaction_valid = {
		# 						recipient = prev.story_owner
		# 						interaction = BMU_request_support_interaction
		# 					}
		# 				}
		# 			}
		# 			add = 1
		# 		}
		# 	}
		# }
	}
}

BMU_stakeholder_tab_gui = {
	scope = character
	saved_scopes = { pressed_claim }
	is_shown = {
		any_contender_story = {
			var:pressed_claim_story = scope:pressed_claim
		}
	}
}

BMU_stakeholder_sorting = {
	scope = character
	saved_scopes = {
		order_by
		player
		pressed_claim
		sort_by
	}
	effect = {
		every_in_list = {
			variable = stakeholders_gui
			add_to_list = stakeholders
		}
		clear_variable_list = stakeholders_gui
		ordered_in_list = {
			list = stakeholders
			order_by = {
				if = {
					limit = { scope:order_by = flag:max_military_strength }
					value = story_owner.max_military_strength
				}
				else_if = {
					limit = { scope:order_by = flag:score_diff }
					story_owner = { value = BMU_score_diff }
				}
				if = {
					limit = { scope:sort_by = flag:Ascending }
					multiply = -1
				}
			}
			max = 1000
			check_range_bounds = no
			prev = {
				add_to_variable_list = {
					name = stakeholders_gui
					target = prev
				}
			}
		}
	}
}

BMU_stakeholder_filter = {
	scope = character
	saved_scopes = {
		recipient
		interaction
	}
	is_shown = {
		trigger_if = {
			limit = { exists = scope:interaction }
			trigger_if = {
				limit = { scope:interaction = flag:request_support }
				is_character_interaction_valid = {
					recipient = scope:recipient
					interaction = BMU_request_support_interaction
				}
			}
			trigger_else_if = {
				limit = { scope:interaction = flag:council_position }
				is_character_interaction_valid = {
					recipient = scope:recipient
					interaction = BMU_bargain_with_owned_title_interaction
				}
			}
			trigger_else_if = {
				limit = { scope:interaction = flag:owned_title }
				is_character_interaction_valid = {
					recipient = scope:recipient
					interaction = BMU_bargain_with_owned_title_interaction
				}
			}
			trigger_else = { always = yes }
		}
	}
}

BMU_request_support_sgui = {
	scope = character
	saved_scopes = {
		recipient
	}
	is_shown = {
		NOT = {
			is_character_interaction_potentially_accepted = {
				recipient = scope:recipient
				interaction = BMU_request_support_interaction
			}
		}
	}
	is_valid = {
		is_character_interaction_valid = {
			recipient = scope:recipient
			interaction = BMU_request_support_interaction
		}
	}
	effect = {
		open_interaction_window = {
			interaction = BMU_request_support_interaction
			actor = root
			recipient = scope:recipient
		}
	}
}

BMU_offer_support_sgui = {
	scope = character
	saved_scopes = {
		recipient
	}
	is_shown = {
		is_character_interaction_shown = {
			recipient = scope:recipient
			interaction = BMU_offer_support_interaction
		}
	}
	is_valid = {
		is_character_interaction_valid = {
			recipient = scope:recipient
			interaction = BMU_offer_support_interaction
		}
	}
	effect = {
		open_interaction_window = {
			interaction = BMU_offer_support_interaction
			actor = root
			recipient = scope:recipient
		}
	}
}

BMU_bargain_with_council_position_sgui = {
	scope = character
	saved_scopes = {
		recipient
	}
	is_shown = {
		NOT = {
			is_character_interaction_potentially_accepted = {
				recipient = scope:recipient
				interaction = BMU_bargain_with_council_position_interaction
			}
		}
	}
	is_valid = {
		is_character_interaction_valid = {
			recipient = scope:recipient
			interaction = BMU_bargain_with_council_position_interaction
		}
	}
	effect = {
		open_interaction_window = {
			interaction = BMU_bargain_with_council_position_interaction
			actor = root
			recipient = scope:recipient
		}
	}
}

BMU_bargain_for_council_position_sgui = {
	scope = character
	saved_scopes = {
		recipient
	}
	is_shown = {
		# is_character_interaction_shown = {
		# 	recipient = scope:recipient
		# 	interaction = BMU_bargain_for_council_position_interaction
		# }
	}
	is_valid = {
		# is_character_interaction_valid = {
		# 	recipient = scope:recipient
		# 	interaction = BMU_bargain_for_council_position_interaction
		# }
	}
	effect = {
		# open_interaction_window = {
		# 	interaction = BMU_bargain_for_council_position_interaction
		# 	actor = root
		# 	recipient = scope:recipient
		# }
	}
}

BMU_bargain_with_owned_title_sgui = {
	scope = character
	saved_scopes = {
		recipient
	}
	is_shown = {
		NOT = {
			any_held_title = {
				prev = {
					is_character_interaction_potentially_accepted = {
						recipient = scope:recipient
						interaction = BMU_bargain_with_owned_title_interaction
						# target_title = title:k_aquitaine
					}
				}
			}
		}
	}
	is_valid = {
		is_character_interaction_valid = {
			recipient = scope:recipient
			interaction = BMU_bargain_with_owned_title_interaction
		}
	}
	effect = {
		open_interaction_window = {
			interaction = BMU_bargain_with_owned_title_interaction
			actor = root
			recipient = scope:recipient
		}
	}
}

BMU_bargain_for_owned_title_sgui = {
	scope = character
	saved_scopes = {
		recipient
	}
	is_shown = {
		# is_character_interaction_shown = {
		# 	recipient = scope:recipient
		# 	interaction = BMU_bargain_for_owned_title_interaction
		# }
	}
	is_valid = {
		# is_character_interaction_valid = {
		# 	recipient = scope:recipient
		# 	interaction = BMU_bargain_for_owned_title_interaction
		# }
	}
	effect = {
		# open_interaction_window = {
		# 	interaction = BMU_bargain_for_owned_title_interaction
		# 	actor = root
		# 	recipient = scope:recipient
		# }
	}
}


tooltip_test = {
	scope = character
	is_shown = {
		is_independent_ruler = yes
	}
}