BMU_bargain_story = {
	on_setup = {
	}
	
	on_end = {
		var:contender = {
			remove_list_variable = {
				name = bargains
				target = prev
			}
		}
	}

	on_owner_death = {
	}

	effect_group = {
		weeks = 1
		triggered_effect = {
			trigger = { debug_only = yes }
			effect = {
				debug_log = "BMU_bargain_story weekly"
				debug_log_scopes = yes
				story_owner = { debug_log_scopes = no }
				if = {
					limit = { has_variable = bargain_type }
					var:bargain_type = { debug_log_scopes = no }
				}
				else = { debug_log = "missing ambition"}
			}
		}
		triggered_effect = {
			trigger = {
				NAND = {
					switch = {
						trigger = var:bargain_type
						flag:FF_ambition_get_council_position = {
							switch = {
								trigger = var:council_position
								flag:councillor_chancellor = {
									BMU_bargain_council_position_is_valid = { PRESSED_CLAIM = scope:story.var:pressed_claim CONTENDER = scope:story.var:contender.story_owner SUPPORTER = scope:story.var:supporter.story_owner COUNCIL_POSITION = councillor_chancellor }
								}
								flag:councillor_steward = {
									BMU_bargain_council_position_is_valid = { PRESSED_CLAIM = scope:story.var:pressed_claim CONTENDER = scope:story.var:contender.story_owner SUPPORTER = scope:story.var:supporter.story_owner COUNCIL_POSITION = councillor_steward }
								}
								flag:councillor_marshal = {
									BMU_bargain_council_position_is_valid = { PRESSED_CLAIM = scope:story.var:pressed_claim CONTENDER = scope:story.var:contender.story_owner SUPPORTER = scope:story.var:supporter.story_owner COUNCIL_POSITION = councillor_marshal }
								}
								flag:councillor_spymaster = {
									BMU_bargain_council_position_is_valid = { PRESSED_CLAIM = scope:story.var:pressed_claim CONTENDER = scope:story.var:contender.story_owner SUPPORTER = scope:story.var:supporter.story_owner COUNCIL_POSITION = councillor_spymaster }
								}
								flag:councillor_court_chaplain = {
									BMU_bargain_council_position_is_valid = { PRESSED_CLAIM = scope:story.var:pressed_claim CONTENDER = scope:story.var:contender.story_owner SUPPORTER = scope:story.var:supporter.story_owner COUNCIL_POSITION = councillor_court_chaplain }
								}
								flag:councillor_castellan = {
									BMU_bargain_council_position_is_valid = { PRESSED_CLAIM = scope:story.var:pressed_claim CONTENDER = scope:story.var:contender.story_owner SUPPORTER = scope:story.var:supporter.story_owner COUNCIL_POSITION = councillor_castellan }
								}
								flag:councillor_admiral = {
									BMU_bargain_council_position_is_valid = { PRESSED_CLAIM = scope:story.var:pressed_claim CONTENDER = scope:story.var:contender.story_owner SUPPORTER = scope:story.var:supporter.story_owner COUNCIL_POSITION = councillor_admiral }
								}
							}
						}
						flag:BMU_bargain_owned_title = {
							BMU_can_bargain_titles = {
								PRESSED_CLAIM = scope:story.var:pressed_claim
								CONTENDER = scope:story.var:contender.story_owner
								SUPPORTER = scope:story.var:supporter.story_owner
							}
							BMU_title_can_be_bargained = {
								GIVER = scope:story.var:contender.story_owner
								TAKER = scope:story.var:supporter.story_owner
								TITLE = scope:story.var:title
							}
						}
					}
				}
			}
			effect = {
				if = {
					limit = { debug_only = yes }
					debug_log = "BMU_bargain_story weekly Bargain invalid"
					debug_log_scopes = yes
					story_owner = { debug_log_scopes = no }
					var:bargain_type = { debug_log_scopes = yes }
				}
				story_owner = {
					send_interface_toast = {
						title = BMU_BARGAIN_INVALIDATED
						left_icon = scope:story.var:supporter.var:stakeholder
					}
				}
				scope:story.var:supporter.var:stakeholder = {
					send_interface_toast = {
						title = BMU_BARGAIN_INVALIDATED
						left_icon = scope:story.story_owner
					}
				}
				end_story = yes
			}
		}
	}
}
