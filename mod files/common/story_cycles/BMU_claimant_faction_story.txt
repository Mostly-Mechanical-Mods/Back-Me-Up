BMU_pressed_claim_story = {
	on_setup = {
		# handled in BMU_create_claim_press effect
	}
	
	on_end = {
	}

	on_owner_death = {
	}

	effect_group = {
		# months = 1
		weeks = 1
		first_valid = {
			triggered_effect = {
				trigger = {
					always = no
					has_variable = rallying_phase
				}
				effect = {
					if = {
						limit = { var:rallying_phase = 5 }
						remove_variable = rallying_phase
						set_variable = {
							name = declaration_phase
							value = 0
						}
					}
					else = {
						change_variable = {
							name = rallying_phase
							add = 1
						}
					}
				}
			}
			triggered_effect = {
				trigger = {
					always = no
					has_variable = contention_phase
					has_variable = stakeholders_added
				}
				effect = {
					remove_variable = contention_phase
					set_variable = {
						name = rallying_phase
						value = 0
					}
				}
			}
			triggered_effect = {
				trigger = {
					has_variable = contention_phase
					NOT = { has_variable = stakeholders_added }
				}
				effect = {
					debug_log = "BMU_pressed_claim triggered_effect"
					debug_log_scopes = no


					story_owner = {
						save_scope_as = claim_target
						every_ally = {
							limit = {
								any_owned_story = {
									story_type = BMU_stakeholder_story
									var:pressed_claim_story = scope:story
									count = 0
								}
								is_landed = yes
							}
							trigger_event = {
								id = BMU_pressed_claim.0011
							}
						}
					}

					every_in_list = {
						variable = BMU_pressed_claim_stakeholders
						limit = {
							var:pressed_claim_story = scope:story
							NOT = { story_owner = scope:claim_target }
							has_variable = status
							var:status = flag:contender
						}
						var:stakeholder = { save_scope_as = contender }
						story_owner = {
							every_ally = {
								limit = {
									any_owned_story = {
										story_type = BMU_stakeholder_story
										var:pressed_claim_story = scope:story
										count = 0
									}
									is_landed = yes
								}
								trigger_event = {
									id = BMU_pressed_claim.0012
									days = 1
								}
							}
						}
					}

					story_owner = {
						every_vassal = {
							limit = {
								any_owned_story = {
									story_type = BMU_stakeholder_story
									var:pressed_claim_story = scope:story
									count = 0
								}
							}
							trigger_event = {
								id = BMU_pressed_claim.0013
								days = 2
							}
						}
						every_realm_county = {
							every_de_jure_top_liege = {
								limit = {
									any_owned_story = {
										story_type = BMU_stakeholder_story
										var:pressed_claim_story = scope:story
										count = 0
									}
								}
								trigger_event = {
									id = BMU_pressed_claim.0014
									days = 3
								}
							}
						}
					}
					
					set_variable = stakeholders_added
				}
			}
		}
	}
}

BMU_stakeholder_story = {
	on_setup = {
		story_owner = {
			add_to_variable_list = {
				name = BMU_stakeholder_stories
				target = prev
			}
		}
		set_variable = {
			name = stakeholder
			value = story_owner
		}
		set_variable = {
			name = supporter_count
			value = 0
		}
	}
	on_end = {
		story_owner = {
			remove_list_variable = {
				name = BMU_pressed_claim_stakeholders
				target = prev
			}
		}
	}
	effect_group = {
		weeks = 1
		triggered_effect = {
			trigger = { has_variable = pressed_claim_story }
			effect = {
				var:pressed_claim_story = {
					ordered_in_list = {
						variable = BMU_pressed_claim_stakeholders
						limit = {
							trigger_if = {
								limit = { has_variable = contender }
								NOT = { this = var:contender }
							}
						}
						order_by = { var:stakeholder = { scope:story.story_owner = { add = BMU_contender_score }}}
						scope:story = {
							set_variable = {
								name = top_alternate_candidate
								value = prev
							}
						}
					}
				}
			}
		}
	}
}