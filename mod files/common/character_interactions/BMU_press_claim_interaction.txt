BMU_press_claim_interaction = {
	category = interaction_category_diplomacy
	use_diplomatic_range = no
	common_interaction = yes
	ignores_pending_interaction_block = yes
	interface_priority = -1
	icon = icon_claim_pressed

	is_highlighted = {
		scope:recipient = {
			any_pressed_claim = {
				scope:actor = { has_claim_on = prev.var:claimed_title }
			}
		}
	}

	desc = BMU_press_claim_interaction_desc

	auto_accept = yes

	popup_on_receive = yes
	pause_on_receive = yes
	ignores_pending_interaction_block = no
	show_answer_notification = no

	greeting = negative
	notification_text = BMU_press_claim_interaction_notification

	ai_min_reply_days = 0							# Minimum days before ai replies
	ai_max_reply_days = 0

	target_type = title
	target_filter = recipient_domain_titles

	cooldown_against_recipient = { years = 1 }

	redirect = {
	}

	is_shown = {
		scope:actor = {
			is_claimant = yes
			has_cb_on = { target = scope:recipient cb = claim_cb }
		}
	}

	is_valid = {
		scope:actor = {
			trigger_if = {
				limit = { is_ai = yes }
				scope:recipient = {
					any_pressed_claim = {
						count > 0
					}
				}
			}
		}
	}
	
	is_valid_showing_failures_only = {
		scope:actor = {
			custom_description = {
				text = BMU_involved_in_another_pressed_claim
				subject = this
				any_contender_story = {
					count = 0
				}
			}
		}
	}

	has_valid_target_showing_failures_only = {
		scope:actor = {
			any_claim = {
				save_temporary_scope_as = claim
				trigger_if = {
					limit = { has_variable = pressed_claim }
					NOR = {
						custom_description = {
							text = BMU_too_late_to_join_pressed_claim
							object = var:pressed_claim
							var:pressed_claim = {
								trigger_if = {
									limit = { scope:actor = { is_ai = yes }}
									NOT = { var:phase = flag:contention_phase }
								}
								trigger_else = {
									OR = {
										var:phase = flag:declaration_phase
										var:phase = flag:war_phase
									}
								}
							}
						}
						custom_description = {
							text = BMU_already_involved_in_pressed_claim
							scope:actor = {
								any_contender_story = {
									var:pressed_claim_story.var:claimed_title = scope:claim
								}
							}
						}
					}
				}
			}
		}
	}

	can_be_picked_title = {
		OR = {
			scope:actor = { has_claim_on = scope:target }
			AND = {
				exists = scope:target.holder
				scope:actor = { is_heir_of = scope:target.holder }
			}
		}
		scope:target = {
			trigger_if = {
				limit = { has_variable = pressed_claim }
				NOR = {
					custom_description = {
						text = BMU_too_late_to_join_pressed_claim
						object = var:pressed_claim
						var:pressed_claim = {
							OR = {
								var:phase = flag:declaration_phase
								var:phase = flag:war_phase
							}
						}
					}
					custom_description = {
						text = BMU_already_involved_in_pressed_claim
						scope:actor = {
							any_contender_story = {
								var:pressed_claim_story.var:claimed_title = scope:target
							}
						}
					}
				}
			}
		}
	}

	can_send = {
	}

	options_heading = BMU_bargain_council_position_interaction_option
	

	on_send = {
		if = {
			limit = { debug_only = yes }
			debug_log = "BMU_press_claim_interaction on_send"
			debug_log_scopes = yes
		}
	}
	
	on_accept = {
		if = {
			limit = { debug_only = yes }
			debug_log = "BMU_press_claim_interaction on_accept"
			debug_log_scopes = yes
		}

		scope:actor = { save_scope_as = claimant }
		scope:recipient = { save_scope_as = claim_target }

		BMU_interaction_press_claim = {
			CLAIMANT = scope:actor
			CLAIM_TARGET = scope:recipient
			CLAIMED_TITLE = scope:target
		}
	}

	ai_potential = { is_claimant = yes }

	ai_targets = {
		ai_recipients = scripted_relations
	}

	ai_frequency = 1

	ai_will_do = {
		base = 0
		modifier = {
			save_temporary_scope_as = score_supporter
			scope:target = { save_temporary_scope_as = claimed_title }
			scope:target.holder = {
				save_temporary_scope_as = score_contender
				save_temporary_scope_as = holder_candidate
				save_temporary_scope_as = claim_target
			}
			add = BMU_contender_legitimacy
		}
		modifier = {
			factor = -1
		}
	}

	ai_accept = {
		base = 0
		modifier = {
			scope:actor = { save_temporary_scope_as = score_supporter }
			scope:target = { save_temporary_scope_as = claimed_title }
			scope:target.holder = {
				save_temporary_scope_as = score_contender
				save_temporary_scope_as = holder_candidate
				save_temporary_scope_as = claim_target
			}
			add = { scope:actor = { add = BMU_contender_legitimacy }}
			desc = "[GuiScope.SetRoot(actor.MakeScope).AddScope('score_contender',recipient.MakeScope).AddScope('score_supporter',actor.MakeScope).AddScope('claim_target',recipient.MakeScope).AddScope('holder_candidate',recipient.MakeScope).AddScope('claimed_title',target.MakeScope).GetScriptValueDesc('BMU_contender_legitimacy')]"
		}
		modifier = {
			factor = -1
		}
	}
}

BMU_press_claim_interaction_script = {
	category = interaction_category_pressed_claim
	use_diplomatic_range = no
	common_interaction = yes
	ignores_pending_interaction_block = yes
	interface_priority = -1
	icon = icon_claim_pressed
	hidden = yes

	desc = BMU_press_claim_interaction

	# auto_accept = yes

	popup_on_receive = yes
	pause_on_receive = yes
	ignores_pending_interaction_block = no
	show_answer_notification = yes

	greeting = negative
	notification_text = BMU_press_claim_interaction_notification
	prompt = test

	ai_min_reply_days = 0							# Minimum days before ai replies
	ai_max_reply_days = 0

	cooldown_against_recipient = { years = 1 }

	redirect = {
	}

	is_shown = {
	}
	
	is_valid_showing_failures_only = {
	}

	can_send = {
	}
	
	on_send = {
		scope:actor = {
			var:BMU_press_claim_interaction_script = { save_scope_as = target }
			remove_variable = BMU_press_claim_interaction_script
			save_scope_as = claimant
		}
		scope:recipient = { save_scope_as = claim_target }
	}
	
	on_accept = {
		if = {
			limit = { debug_only = yes }
			debug_log = "BMU_press_claim_interaction_script"
			debug_log_scopes = yes
		}

		BMU_interaction_press_claim = {
			CLAIMANT = scope:actor
			CLAIM_TARGET = scope:recipient
			CLAIMED_TITLE = scope:target
		}
	}

}

BMU_see_pressed_claim_interaction = {
	category = interaction_category_pressed_claim
	use_diplomatic_range = yes
	common_interaction = yes
	ignores_pending_interaction_block = yes
	interface_priority = -1
	icon = icon_claim_pressed
	hidden = yes

	desc = BMU_see_pressed_claim_interaction

	# auto_accept = yes

	popup_on_receive = no
	pause_on_receive = no
	ignores_pending_interaction_block = yes
	show_answer_notification = no

	auto_accept = yes

	redirect = {
		scope:recipient = { save_scope_as = secondary_actor }
		scope:actor = { save_scope_as = recipient }
	}

	populate_actor_list = {
		scope:actor = {
			every_pretender_title = {
				limit = {
					exists = holder
					has_variable = pressed_claim
				}
				holder = { add_to_list = characters }
			}
			every_claim = {
				limit = {
					exists = holder
					has_variable = pressed_claim
				}
				holder = { add_to_list = characters }
			}
			every_ally = {
				limit = { any_pressed_claim = { count > 0 }}
				add_to_list = characters
			}
			every_close_family_member = {
				limit = { any_pressed_claim = { count > 0 }}
				add_to_list = characters
			}
			every_relation = {
				type = friend
				limit = { any_pressed_claim = { count > 0 }}
				add_to_list = characters
			}
			every_relation = {
				type = lover
				limit = { any_pressed_claim = { count > 0 }}
				add_to_list = characters
			}
			every_relation = {
				type = rival
				limit = { any_pressed_claim = { count > 0 }}
				add_to_list = characters
			}
			if = {
				limit = { dynasty.dynast = this }
				dynasty = {
					every_dynasty_member = {
						limit = { any_pressed_claim = { count > 0 }}
						add_to_list = characters
					}
				}
			}
			if = {
				limit = { house.house_head = this }
				house = {
					every_house_member = {
						limit = { any_pressed_claim = { count > 0 }}
						add_to_list = characters
					}
				}
			}
		}
	}

	can_send = {
	}
	
	target_type = title
	target_filter = secondary_actor_domain_titles

	can_be_picked_title = {
		scope:secondary_actor = {
			any_pressed_claim = {
				var:claimed_title = scope:target
			}
		}
	}

	on_send = {
		scope:secondary_actor = {
			random_pressed_claim = {
				limit = { var:claimed_title = scope:target }
				scope:actor = {
					add_to_variable_list = {
						name = pressed_claim_gui
						target = prev
					}
				}
				add_to_variable_list = {
					name = pressed_claim_gui
					target = scope:actor
				}
			}
		}
	}
	
	on_accept = {
		scope:actor = {
			custom_tooltip = BMU_see_pressed_claim_effect
		}
	}

}

# BMU_press_claim_interaction_AI_evaluate = {
# 	category = interaction_category_pressed_claim
# 	use_diplomatic_range = no
# 	common_interaction = yes
# 	ignores_pending_interaction_block = yes
# 	interface_priority = -1
# 	icon = icon_claim_pressed

# 	desc = BMU_press_claim_interaction

# 	auto_accept = no

# 	popup_on_receive = yes
# 	pause_on_receive = no
# 	ignores_pending_interaction_block = yes

# 	cooldown_against_recipient = { years = 1 }

# 	redirect = {
# 	}

# 	is_shown = {
# 		scope:actor = { has_variable = BMU_press_claim_interaction_AI }
# 	}
	
# 	is_valid_showing_failures_only = {
# 		scope:actor = {
# 			is_claimant = yes
# 			OR = {
# 				has_strong_claim_on = var:BMU_press_claim_interaction_AI
# 				has_weak_claim_on = var:BMU_press_claim_interaction_AI
# 			}
# 			custom_description = {
# 				text = BMU_involved_in_another_pressed_claim
# 				subject = this
# 				any_contender_story = {
# 					count = 0
# 				}
# 			}
# 		}
# 	}

# 	can_send = {
# 		scope:actor = { has_variable = BMU_press_claim_interaction_AI }
# 	}

# 	options_heading = BMU_bargain_council_position_interaction_option
	

# 	on_send = {
# 		scope:actor.var:BMU_press_claim_interaction_AI = { save_scope_as = target }
# 	}
	
# 	on_accept = {
# 		scope:actor.var:BMU_press_claim_interaction_AI = { save_scope_as = target }
# 		scope:actor = { save_scope_as = claimant }
# 		scope:actor.var:BMU_press_claim_interaction_AI.holder = { save_scope_as = claim_target }

# 		if = {
# 			limit = { debug_only = yes }
# 			debug_log = "BMU_press_claim_interaction_AI"
# 			debug_log_scopes = yes
# 		}
# 		BMU_interaction_press_claim = yes
# 	}

# 	ai_targets = {
# 		ai_recipients = self
# 		ai_frequency = 360
# 	}

# 	ai_accept = {
# 		base = 0
# 		modifier = {
# 			trigger_if = {
# 				limit = { NOT = { exists = scope:target }}
# 				scope:actor.var:BMU_press_claim_interaction_AI = { save_temporary_scope_as = target }
# 			}
# 			scope:target.holder = { save_temporary_scope_as = candidate }
# 			save_temporary_scope_value_as = {
# 				name = actor_score
# 				value = BMU_contender_score
# 			}
# 			add = 0
# 		}
# 		BMU_bargain_title = yes
# 	}
# }